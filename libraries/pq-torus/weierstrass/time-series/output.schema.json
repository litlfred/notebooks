{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Weierstrass Time-Series Widget Output", 
  "description": "Output schema for time evolution visualization results",
  "type": "object",
  "properties": {
    "success": {
      "type": "boolean",
      "description": "Whether the computation succeeded"
    },
    "plot_data": {
      "type": "object",
      "properties": {
        "image_base64": {
          "type": "string",
          "description": "Base64 encoded plot image or plot identifier"
        },
        "width": {
          "type": "integer",
          "minimum": 100,
          "description": "Plot width in pixels"
        },
        "height": {
          "type": "integer", 
          "minimum": 100,
          "description": "Plot height in pixels"
        },
        "format": {
          "type": "string",
          "enum": ["png", "svg", "pdf"],
          "description": "Image format"
        },
        "panels": {
          "type": "integer",
          "minimum": 1,
          "maximum": 2,
          "description": "Number of plot panels (real/imaginary)"
        }
      },
      "required": ["image_base64", "width", "height", "format"]
    },
    "time_series_data": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "particle_id": {
            "type": "integer",
            "description": "Particle identifier"
          },
          "times": {
            "type": "array",
            "items": {"type": "number"},
            "description": "Time values"
          },
          "trajectory": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "real": {"type": "number"},
                "imag": {"type": "number"}
              },
              "required": ["real", "imag"]
            },
            "description": "Complex trajectory z(t)"
          },
          "wp_real": {
            "type": "array",
            "items": {"type": "number"},
            "description": "Real part of ℘(z(t))"
          },
          "wp_imag": {
            "type": "array", 
            "items": {"type": "number"},
            "description": "Imaginary part of ℘(z(t))"
          },
          "blowup_point": {
            "type": ["object", "null"],
            "properties": {
              "time": {"type": "number"},
              "position": {
                "type": "object",
                "properties": {
                  "real": {"type": "number"},
                  "imag": {"type": "number"}
                }
              }
            },
            "description": "Blow-up detection information"
          }
        },
        "required": ["particle_id", "times", "trajectory", "wp_real", "wp_imag"]
      },
      "description": "Time series data for all particles"
    },
    "trajectory_stats": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "particle_id": {"type": "integer"},
          "initial_z": {
            "type": "object",
            "properties": {
              "real": {"type": "number"},
              "imag": {"type": "number"}
            },
            "required": ["real", "imag"]
          },
          "initial_v": {
            "type": "object",
            "properties": {
              "real": {"type": "number"},
              "imag": {"type": "number"}
            },
            "required": ["real", "imag"]
          },
          "final_time": {"type": "number"},
          "steps_computed": {"type": "integer"},
          "blowup_detected": {"type": "boolean"},
          "max_wp_magnitude": {"type": "number"}
        },
        "required": ["particle_id", "initial_z", "initial_v", "final_time", "steps_computed"]
      },
      "description": "Statistical summary of trajectory computations"
    },
    "lattice_params": {
      "type": "object",
      "properties": {
        "p": {"type": "number"},
        "q": {"type": "number"},
        "N": {"type": "integer"},
        "lattice_type": {"type": "string"}
      },
      "required": ["p", "q", "N"],
      "description": "Lattice parameters used"
    },
    "visualization_params": {
      "type": "object",
      "properties": {
        "dt": {"type": "number"},
        "T": {"type": "number"},
        "blow_thresh": {"type": "number"},
        "show_real": {"type": "boolean"},
        "show_imaginary": {"type": "boolean"},
        "grid": {"type": "boolean"},
        "legend": {"type": "boolean"},
        "particle_count": {"type": "integer"}
      },
      "description": "Visualization parameters used"
    },
    "error": {
      "type": "string",
      "description": "Error message if computation failed"
    },
    "error_type": {
      "type": "string",
      "description": "Type of error that occurred"
    }
  },
  "required": ["success"],
  "additionalProperties": false,
  "allOf": [
    {
      "if": {"properties": {"success": {"const": true}}},
      "then": {"required": ["plot_data", "time_series_data", "trajectory_stats", "lattice_params", "visualization_params"]}
    },
    {
      "if": {"properties": {"success": {"const": false}}},
      "then": {"required": ["error"]}
    }
  ]
}